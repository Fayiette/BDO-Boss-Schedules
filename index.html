<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NA Black Desert Online Boss Timer</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://moment.github.io/luxon/global/luxon.min.js"></script>
  <style>
    body {
      font-family: 'Roboto', Arial, sans-serif;
      background-color: #1C2526; /* Navy Blue */
      color: #D3D3D3; /* Light Grey for text */
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      color: #FFFFFF; /* White for header */
      text-align: center;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }
    .boss-info-container {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .boss-info {
      flex: 1;
      margin: 0 10px;
      padding: 15px;
      background-color: #2A3439; /* Slightly lighter Navy Blue */
      border: 2px solid #4682B4; /* Steel Grey */
      border-radius: 8px;
      text-align: center;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .boss-info:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(70, 130, 180, 0.3); /* Steel Grey shadow */
    }
    .boss-info h2 {
      color: #4682B4; /* Steel Grey */
      margin: 0 0 10px;
      font-size: 0.9em; /* Smaller than boss names */
    }
    .boss-info p {
      color: #FFFFFF; /* White for default text */
      margin: 0;
      font-size: 1.1em; /* Boss names */
    }
    .timer {
      color: #D3D3D3; /* Light Grey for timer */
      font-size: 1.3em; /* Larger than boss names */
      margin-top: 5px;
    }
    .timer-green {
      color: #008000; /* Green for timers < 3 minutes */
      font-size: 1.3em; /* Larger than boss names */
      margin-top: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #2A3439; /* Slightly lighter Navy Blue */
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }
    th, td {
      border: 1px solid #4682B4; /* Steel Grey */
      padding: 10px;
      text-align: center;
      color: #D3D3D3; /* Light Grey */
    }
    th {
      background-color: #4682B4; /* Steel Grey */
      color: #FFFFFF; /* White */
      font-weight: bold;
    }
    td:hover {
      background-color: #3A4B5C; /* Slightly lighter Steel Grey for hover */
      cursor: pointer;
    }
    tr.next-period {
      background-color: #6A829C; /* Lighter Steel Grey for highlight */
    }
    td.next-boss-cell {
      background-color: #424756 !important; /* green highlight */
      color: #FFFFFF !important;
      font-weight: bold;
      border: 2px solid #809DAF; /*border to make it stand out */
    }
    td.next-boss-cell:hover {
      background-color: #424756 !important; /* keep same highlight on hover */
      cursor: pointer;
    }
    .timer-red {
    color: #894244 !important; /* Added !important */
    font-size: 1.3em !important;
    margin-top: 10px !important;
    font-weight: bold !important;
    }

    .timer-green {
        color: #48bb78 !important; /* Added !important */
        font-size: 1.5em !important; /* This is correctly larger to make it stand out */
        margin-top: 5px !important;
        font-weight: bold !important;
    }

    .timer-orange {
        color: #FFA500 !important; /* Added !important */
        font-size: 1.3em !important;
        margin-top: 10px !important;
        font-weight: bold !important;
}


    /* Boss-specific colors */
    .boss-Nouver { color: orange; }
    .boss-Kzarka { color: rgb(245, 101, 101); }
    .boss-Garmoth { color: pink; }
    .boss-Sangoon { color: green; }
    .boss-GoldenPigKing { color: yellow; }
    .boss-Uturi { color: rgb(66, 153, 225); }
    .boss-Bulgasal { color: brown; }
    .boss-Vell { color: teal; }
    .boss-Kutum { color: rgb(159, 122, 234); }
    .boss-Karanda { color: skyblue; }
    .boss-BlackShadow { color: #696969; } /* Retained from previous */
    @media (max-width: 600px) {
      .boss-info-container {
        flex-direction: column;
      }
      .boss-info {
        margin: 10px 0;
      }
    }
  </style>
</head>
<body>
  <h1>Black Desert Online Boss Timer</h1>

  <div class="boss-info-container">
    <div class="boss-info" role="region" aria-label="Previous Boss">
      <h2>Previous Boss</h2>
      <p id="previous-boss">Loading...</p>
      <p id="previous-timer"></p>
    </div>
    <div class="boss-info" role="region" aria-label="Next Boss">
      <h2>Next Boss</h2>
      <p id="next-boss">Loading...</p>
      <p id="next-timer"></p>
    </div>
    <div class="boss-info" role="region" aria-label="Followed By">
      <h2>Followed By</h2>
      <p id="followed-by">Loading...</p>
      <p id="followed-by-timer"></p>
    </div>
  </div>
<table id="boss-table">
  <tr>
    <th>Time</th>
    </tr>
</table>

<script>
  // Luxon is already included in the HTML.
  const { DateTime } = luxon;
const schedule = [
  { time: "00:00", days: { Monday: ["Nouver"], Tuesday: ["Kzarka","Uturi"], Wednesday: ["Nouver"], Thursday: ["Karanda"], Friday: ["Kutum"], Saturday: ["Kutum"], Sunday: ["Kutum"] }},
  { time: "03:00", days: { Monday: ["Kzarka","Sangoon","Golden Pig King"], Tuesday: [], Wednesday: ["Kutum"], Thursday: ["Nouver"], Friday: ["Nouver","Sangoon"], Saturday: ["Karanda"], Sunday: ["Nouver","Sangoon"] }},
  { time: "05:00", days: { Monday: ["Garmoth"], Tuesday: ["Garmoth","Golden Pig King"], Wednesday: ["Garmoth","Golden Pig King"], Thursday: ["Garmoth","Golden Pig King"], Friday: ["Garmoth","Uturi"], Saturday: ["Garmoth","Bulgasal"], Sunday: ["Garmoth","Golden Pig King","Uturi"] }},
  { time: "07:00", days: { Monday: ["Vell"], Tuesday: ["Kutum","Bulgasal"], Wednesday: ["Nouver","Bulgasal"], Thursday: ["Kutum","Bulgasal"], Friday: ["Kzarka","Sangoon","Bulgasal"], Saturday: ["Nouver","Uturi","Golden Pig King"], Sunday: ["Bulgasal","Golden Pig King"] }},
  { time: "10:00", days: { Monday: ["Bulgasal"], Tuesday: ["Nouver","Bulgasal","Golden Pig King"], Wednesday: ["Karanda"], Thursday: ["Vell","Sangoon"], Friday: ["Kutum","Bulgasal"], Saturday: ["Kzarka","Bulgasal"], Sunday: ["Karanda","Kzarka","Bulgasal"] }},
  { time: "10:15", days: { Monday: ["Garmoth"], Tuesday: [], Wednesday: [], Thursday: [], Friday: [], Saturday: [], Sunday: [] }},
  { time: "13:15", days: { Monday: ["Kzarka","Nouver","Uturi"], Tuesday: ["Kzarka","Sangoon"], Wednesday: ["Bulgasal"], Thursday: ["Karanda","Kzarka","Uturi"], Friday: ["Uturi"], Saturday: ["Kzarka","Kutum"], Sunday: [] }},
  { time: "14:15", days: { Monday: ["Garmoth","Golden Pig King"], Tuesday: ["Garmoth","Uturi"], Wednesday: ["Garmoth","Sangoon"], Thursday: ["Garmoth"], Friday: ["Garmoth","Golden Pig King"], Saturday: ["Garmoth"], Sunday: [] }},
  { time: "15:15", days: { Monday: ["Karanda","Kutum","Sangoon"], Tuesday: ["Karanda","Sangoon"], Wednesday: ["Kzarka","Kutum","Uturi"], Thursday: ["Nouver","Golden Pig King"], Friday: ["Karanda","Kzarka","Sangoon"], Saturday: ["Karanda","Golden Pig King"], Sunday: ["Nouver","Kutum","Sangoon"] }},
  { time: "17:00", days: { Monday: ["Karanda"], Tuesday: ["Kutum"], Wednesday: ["Karanda"], Thursday: ["Kutum"], Friday: ["Nouver"], Saturday: ["Uturi"], Sunday: ["Kzarka","Uturi"] }},
  { time: "20:00", days: { Monday: ["Kzarka"], Tuesday: ["Kzarka"], Wednesday: ["Kzarka"], Thursday: [], Friday: ["Karanda"], Saturday: ["Nouver"], Sunday: ["Kutum"] }}
];



  // Boss color mapping for dynamic application
  const bossColors = {
    "Nouver": "boss-Nouver",
    "Kzarka": "boss-Kzarka",
    "Karanda": "boss-Karanda",
    "Kutum": "boss-Kutum",
    "Garmoth": "boss-Garmoth",
    "Vell": "boss-Vell",
    "Uturi": "boss-Uturi",
    "Sangoon": "boss-Sangoon",
    "Bulgasal": "boss-Bulgasal",
    "Golden Pig King": "boss-GoldenPigKing",
    "Black Shadow": "boss-BlackShadow"
  };

  // Helper to get boss image filename
  function getBossImage(bossName) {
    if (bossName === "Golden Pig King") return "images/pigking.webp";
    return `images/${bossName.toLowerCase().replace(/ /g, '')}.webp`;
  }

function createBossHTML(bosses) {
  if (!bosses || bosses.length === 0 || bosses.includes("None")) return "None";

  return `
    <div style="display:flex; flex-wrap: wrap; justify-content: center; align-items: flex-end; gap: 10px;">
      ${bosses.map(boss => {
        const imgSrc = getBossImage(boss);
        const colorClass = bossColors[boss];

        return `
          <div style="
            display:flex;
            flex-direction:column;
            align-items:center;
            text-align:center;
          ">
            <img src="${imgSrc}" alt="${boss}" class="${colorClass}" style="
              width: 100px;
              height: 100px;
              object-fit: cover;
              border-radius: 50%;
              border: 3px solid;
            ">
            <span class="${colorClass}" style="font-size: 0.8em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${boss}</span>
          </div>
        `;
      }).join("")}
    </div>
  `;
}

  function formatTimeDiff(seconds) {
    const hours = Math.floor(seconds / 3600);
    seconds %= 3600;
    const minutes = Math.floor(seconds / 60);
    seconds = Math.floor(seconds % 60);
    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  }

// Convert schedule times to local time and sort chronologically by time of day, ignoring date shifts.
  const sortedSchedule = schedule.slice().sort((a, b) => {
    const timeA_Local = DateTime.fromFormat(a.time, "HH:mm", { zone: 'UTC+10' }).toLocal();
    const timeB_Local = DateTime.fromFormat(b.time, "HH:mm", { zone: 'UTC+10' }).toLocal();

    // Create a numerical value for each time (e.g., 3:15 PM becomes 15*60 + 15) to sort correctly.
    const timeA_Value = timeA_Local.hour * 60 + timeA_Local.minute;
    const timeB_Value = timeB_Local.hour * 60 + timeB_Local.minute;

    return timeA_Value - timeB_Value;
  });

  function updateDayHeaders() {
      const tableHeaderRow = document.querySelector("#boss-table tr");
      
      while (tableHeaderRow.cells.length > 1) {
          tableHeaderRow.deleteCell(1);
      }

      const daysOfWeek = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
      
      daysOfWeek.forEach(day => {
          const headerCell = document.createElement("th");
          headerCell.textContent = day;
          tableHeaderRow.appendChild(headerCell);
      });
  }

  function buildScheduleTable() {
    const tableBody = document.getElementById("boss-table");
    
    while (tableBody.rows.length > 1) {
      tableBody.deleteRow(1);
    }
    
    const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
    
    sortedSchedule.forEach(slot => {
      const row = tableBody.insertRow(-1);
      
      const scheduleTimeUTC10 = DateTime.fromFormat(slot.time, "HH:mm", { zone: 'UTC+10' });
      const localTime = scheduleTimeUTC10.toLocal();
      const localTimeString = localTime.toLocaleString(DateTime.TIME_SIMPLE);

      const timeCell = row.insertCell(-1);
      timeCell.textContent = localTimeString;

      days.forEach(day => {
        const cell = row.insertCell(-1);
        
        // This is the key logic to correctly map UTC+10 data to a local-time grid.
        // We calculate the UTC+10 day for the current time slot *on each day of the week*.
        const localDateTime = DateTime.local().set({
            weekday: days.indexOf(day) + 1,
            hour: localTime.hour,
            minute: localTime.minute,
            second: 0
        });
        const utc10Day = localDateTime.setZone('UTC+10').toLocaleString({ weekday: 'long' });
        
        const bosses = slot.days[utc10Day] || [];
        
        if (bosses.length > 0) {
          cell.innerHTML = bosses.map(boss => `<span class="${bossColors[boss]}">${boss}</span>`).join("<br>");
        } else {
          cell.textContent = "-";
        }
      });
    });
  }

  function updateBossInfo() {
    const now = DateTime.local();
    const scheduleTimezone = 'UTC+10';
    const currentDay = now.toLocaleString({ weekday: 'long' });

    let previousBoss = "None";
    let previousTime = null;
    let nextBoss = "None";
    let nextTime = null;
    let followedBy = "None";
    let followedByTime = null;
    let nextPeriodLuxon = null;

    function createScheduleTime(timeStr) {
      const [hours, minutes] = timeStr.split(':').map(Number);
      return DateTime.fromObject({ hour: hours, minute: minutes }, { zone: scheduleTimezone });
    }

    for (let i = -1; i <= 7; i++) {
      const checkDayLuxon = now.plus({ days: i });
      const checkDay = checkDayLuxon.toLocaleString({ weekday: 'long' });

      for (const slot of schedule) {
        const bosses = slot.days[checkDay] || [];
        if (bosses.length === 0) continue;

        const scheduleTimeUTC10 = createScheduleTime(slot.time);
        const scheduleTime = scheduleTimeUTC10.set({ year: checkDayLuxon.year, month: checkDayLuxon.month, day: checkDayLuxon.day });
        const scheduleTimeLocal = scheduleTime.setZone(now.zone);
          
        if (scheduleTimeLocal <= now && (previousTime === null || scheduleTimeLocal > previousTime)) {
          previousBoss = bosses.map(boss => `<span class="${bossColors[boss]}">${boss}</span>`).join(", ");
          previousTime = scheduleTimeLocal;
        }

        if (scheduleTimeLocal > now) {
          if (nextTime === null) {
            nextBoss = bosses.map(boss => `<span class="${bossColors[boss]}">${boss}</span>`).join(", ");
            nextTime = scheduleTimeLocal;
            nextPeriodLuxon = scheduleTimeLocal;
          } else if (followedByTime === null) {
            followedBy = bosses.map(boss => `<span class="${bossColors[boss]}">${boss}</span>`).join(", ");
            followedByTime = scheduleTimeLocal;
          } else {
            i = 8;
            break;
          }
        }
      }
    }

    document.getElementById("previous-boss").innerHTML = createBossHTML(previousBoss.split(", ").map(b => b.replace(/<[^>]*>/g,'')));
    document.getElementById("next-boss").innerHTML = createBossHTML(nextBoss.split(", ").map(b => b.replace(/<[^>]*>/g,'')));
    document.getElementById("followed-by").innerHTML = createBossHTML(followedBy.split(", ").map(b => b.replace(/<[^>]*>/g,'')));

      if (previousTime !== null) {
      const timeSince = now.diff(previousTime, 'seconds').toObject().seconds;
      document.getElementById("previous-timer").textContent = `Spawned ${formatTimeDiff(timeSince)} ago`;
      document.getElementById("previous-timer").className = "timer-red"; // Always red
    } else {
      document.getElementById("previous-timer").textContent = "N/A";
      document.getElementById("previous-timer").className = "timer";
    }

    if (nextTime !== null) {
      const timeUntil = nextTime.diff(now, 'seconds').toObject().seconds;
      document.getElementById("next-timer").textContent = `Spawning in ${formatTimeDiff(timeUntil)}`;
      document.getElementById("next-timer").className = "timer-green"; // Always green
    } else {
      document.getElementById("next-timer").textContent = "N/A";
      document.getElementById("next-timer").className = "timer";
    }

    if (followedByTime !== null) {
      const timeUntil = followedByTime.diff(now, 'seconds').toObject().seconds;
      document.getElementById("followed-by-timer").textContent = `Spawning in ${formatTimeDiff(timeUntil)}`;
      document.getElementById("followed-by-timer").className = "timer-orange"; // Always orange
    } else {
      document.getElementById("followed-by-timer").textContent = "N/A";
      document.getElementById("followed-by-timer").className = "timer";
    }

    if (nextPeriodLuxon) {
      document.querySelectorAll("#boss-table td.next-boss-cell").forEach(cell => {
        cell.classList.remove("next-boss-cell");
      });

      const timeStringLocal = nextPeriodLuxon.toLocaleString(DateTime.TIME_SIMPLE).replace(/\s/g,'');
      const dayOfWeekLocal = nextPeriodLuxon.toLocaleString({ weekday: 'long' });

      const rows = document.querySelectorAll("#boss-table tr");
      const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
      const dayIndex = days.indexOf(dayOfWeekLocal);
      
      rows.forEach(row => {
        const timeCell = row.cells[0];
        if (timeCell && timeCell.textContent.replace(/\s/g,'').toLowerCase().includes(timeStringLocal.toLowerCase())) {
          if (dayIndex !== -1) {
            const targetCell = row.cells[dayIndex + 1];
            if (targetCell) {
              targetCell.classList.add("next-boss-cell");
            }
          }
        }
      });
    }
  }

  // Initial table build and update
  updateDayHeaders();
  buildScheduleTable();
  updateBossInfo();

  // Update every second for timers, and rebuild the table every minute
  setInterval(updateBossInfo, 1000);
  setInterval(() => {
    buildScheduleTable();
  }, 60000);

  document.getElementById('current-year').textContent = new Date().getFullYear();
</script>


  <hr style="
  border: none;
  height: 1px;
  background: linear-gradient(to right, rgba(70,130,180,0), rgba(70,130,180,0.8), rgba(70,130,180,0));
  box-shadow: 0 1px 3px rgba(0,0,0,0.3);
  margin: 25px 0 10px 0;
">
<footer id="footer" style="text-align:center; margin-top:5px; padding:10px; color:#D3D3D3; font-size:0.9em;">
  &copy; 2012&ndash;<span id="current-year"></span> 
  <a href="https://fayiette.com/" target="_blank" style="color:#4682B4; text-decoration:none;">Fayiette&trade;</a> &mdash; All Rights Reserved.
</footer>

<script>
  document.getElementById('current-year').textContent = new Date().getFullYear();
</script>

</body>
</html>
